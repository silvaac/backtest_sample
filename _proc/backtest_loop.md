---
output-file: backtest_loop.html
title: Backtest

---



<!-- WARNING: THIS FILE WAS AUTOGENERATED! DO NOT EDIT! -->

Main backtest loop

---

[source](https://github.com/silvaac/backtest_sample/blob/main/backtest_sample/backtest_loop.py#L13){target="_blank" style="float:right; font-size:smaller"}

### backtest

>      backtest (data, param)


## Example

::: {.cell}
``` {.python .cell-code}
prm = {}
prm['when_trade'] = 'open'
prm['start_date'] = 100
prm['mawin'] = 10
prm['sdwin'] = 30
prm['wvol']  = 60
prm['target_vol'] = 0.005
prm['AUM'] = 10e6
prm['tc_slope'] = 1e3
prm['tc_bias'] = 100
prm['er_member_func'] = get_er()
prm['risk_member_func'] = get_risk()
prm['tc_member_func'] = get_tc()
prm['pm_member_func'] = get_pm()
```
:::


::: {.cell}
``` {.python .cell-code}
import_module = get_data()
df = import_module('BTC-USD').sim_data()
print(df)
```
:::


::: {.cell}
``` {.python .cell-code}
bkt = backtest(df,prm)
```
:::


::: {.cell}
``` {.python .cell-code}
import matplotlib.pyplot as plt
import numpy as np

# Plot the data
plt.plot(bkt['pnl'].cumsum())

# Add labels and title
plt.xlabel('')
plt.ylabel('$')
plt.title('Performance')

# Show the plot
plt.show()
```

::: {.cell-output .cell-output-display}
![](backtest_loop_files/figure-html/cell-6-output-1.png){}
:::
:::


### Run parameters optimization

In series using a simple for loop:

::: {.cell}
``` {.python .cell-code}
bkts = []
for i in range(0,40,2):
    prm['mawin'] = 10*(i+1)
    #print(prm['mawin'])
    bkt = backtest(df,prm)
    bkts.append(bkt)
```
:::


In parallel using multiprocessing:

::: {.cell}
``` {.python .cell-code}
@parfor(range(0,40,2)) # also works:[0,2,10,20]
def fun(i):
    prm['mawin'] = 10*(i+1)
    return backtest(df,prm)
```

::: {.cell-output .cell-output-stderr}
```
  0%|                                                   | 0/20 [00:00<?, ?it/s]  5%|██▏                                        | 1/20 [00:03<01:04,  3.41s/it] 25%|██████████▊                                | 5/20 [00:03<00:08,  1.85it/s] 40%|█████████████████▏                         | 8/20 [00:03<00:03,  3.20it/s] 50%|█████████████████████                     | 10/20 [00:05<00:04,  2.30it/s] 65%|███████████████████████████▎              | 13/20 [00:05<00:01,  3.55it/s] 75%|███████████████████████████████▌          | 15/20 [00:05<00:01,  4.44it/s] 85%|███████████████████████████████████▋      | 17/20 [00:06<00:00,  3.37it/s]100%|██████████████████████████████████████████| 20/20 [00:06<00:00,  3.09it/s]
```
:::
:::


